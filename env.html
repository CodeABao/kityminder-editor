<!DOCTYPE html>
<html>

<head>
    <script src="node_modules/@microsoft/teams-js/dist/MicrosoftTeams.min.js"></script>
    <script type="module" src="https://unpkg.com/@fluentui/web-components"></script>
</head>

<body>
    <fluent-text-field appearance="outline" placeholder="file url or create new one" id="fileUrl" style="width: 100%;">
        File Url:</fluent-text-field>
    <fluent-button appearance="accent" id="btnStart">Start</fluent-button>
    <script>
        microsoftTeams.initialize();
        document.getElementById("btnStart").onclick = function () {
            microsoftTeams.getContext(function (context) {
                microsoftTeams.authentication.authenticate({
                    url: window.location.origin + "/auth-start2.html",
                    width: 600,
                    height: 535,
                    successCallback: function (result) {
                        debugger;
                        var token = JSON.parse(localStorage.getItem(result));
                        var fileUrl = "https://lenovobeijing-my.sharepoint.com/:t:/r/personal/libx6_lenovo_com/Documents/Sync/Work/20170116.txt";
                        var urls = fileUrl.split("/");
                        var hostUrl = "https://" + urls[2];
                        var fileRelativeUrl = fileUrl.replace(hostUrl, "");
                        var siteUrl;
                        if (fileUrl.indexOf(":t:") > -1) {
                            siteUrl = hostUrl + "/" + urls[5] + "/" + urls[6];
                            fileRelativeUrl = fileRelativeUrl.replace("/:t:/r", "");
                        } else {
                            siteUrl = hostUrl + "/" + urls[3] + "/" + urls[4];
                        }                  

                        var reqUrl = siteUrl + "/_api/web/GetFileByServerRelativeUrl('" + fileRelativeUrl + "')/$value";

                        fetch(new Request(reqUrl, {
                            method: 'get',
                            headers: {
                                'Content-Type': 'application/json;charset=utf-8;',
                                'Authorization':token.accessToken
                            }
                        })).then(postListRes => {
                            debugger;

                        })
                    },
                    failureCallback: function (reason) {
                        console.log("Login failed: " + reason);
                        debugger;
                    }
                });
            })
        }
    </script>
</body>

</html>